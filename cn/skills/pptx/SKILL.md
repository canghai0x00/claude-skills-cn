---
name: pptx
description: "演示文稿创建、编辑和分析。当Claude需要处理演示文稿(.pptx文件)进行：(1)创建新的演示文稿，(2)修改或编辑内容，(3)处理布局，(4)添加注释或演讲者备注，或任何其他演示文稿任务时使用"
license: 专有。LICENSE.txt包含完整条款
---

# PPTX 创建、编辑和分析

## 概述

用户可能会要求你创建、编辑或分析.pptx 文件的内容。.pptx 文件本质上是包含 XML 文件和其他资源的 ZIP 压缩包，你可以读取或编辑它。针对不同任务，你有不同的工具和工作流程可用。

## 读取和分析内容

### 文本提取

如果你只需要读取演示文稿的文本内容，应该将文档转换为 markdown：

```bash
# 将文档转换为markdown
python -m markitdown path-to-file.pptx
```

### 原始 XML 访问

你需要原始 XML 访问以获取：注释、演讲者备注、幻灯片布局、动画、设计元素和复杂格式。对于任何这些功能，你需要解压演示文稿并读取其原始 XML 内容。

#### 解压文件

`python ooxml/scripts/unpack.py <office_file> <output_dir>`

**注意**：unpack.py 脚本位于项目根目录下的`skills/pptx/ooxml/scripts/unpack.py`。如果脚本不存在于此路径，使用`find . -name "unpack.py"`来定位它。

#### 关键文件结构

- `ppt/presentation.xml` - 主演示文稿元数据和幻灯片引用
- `ppt/slides/slide{N}.xml` - 单个幻灯片内容（slide1.xml、slide2.xml 等）
- `ppt/notesSlides/notesSlide{N}.xml` - 每张幻灯片的演讲者备注
- `ppt/comments/modernComment_*.xml` - 特定幻灯片的评论
- `ppt/slideLayouts/` - 幻灯片的布局模板
- `ppt/slideMasters/` - 母版幻灯片模板
- `ppt/theme/` - 主题和样式信息
- `ppt/media/` - 图像和其他媒体文件

#### 排版和颜色提取

**当给定示例设计来模仿时**：始终首先使用以下方法分析演示文稿的排版和颜色：

1. **读取主题文件**：检查`ppt/theme/theme1.xml`中的颜色（`<a:clrScheme>`）和字体（`<a:fontScheme>`）
2. **样本幻灯片内容**：检查`ppt/slides/slide1.xml`中的实际字体使用（`<a:rPr>`）和颜色
3. **搜索模式**：使用 grep 在所有 XML 文件中查找颜色（`<a:solidFill>`、`<a:srgbClr>`）和字体引用

## 创建新的 PowerPoint 演示文稿**（不使用模板）**

从头创建新的 PowerPoint 演示文稿时，使用**html2pptx**工作流程将 HTML 幻灯片转换为 PowerPoint，实现精确定位。

### 设计原则

**关键**：在创建任何演示文稿之前，分析内容并选择合适的设计元素：

1. **考虑主题内容**：这个演示文稿是关于什么的？它暗示什么基调、行业或氛围？
2. **检查品牌**：如果用户提到公司/组织，考虑其品牌颜色和标识
3. **匹配调色板与内容**：选择反映主题的颜色
4. **阐明你的方法**：在编写代码之前解释你的设计选择

**要求**：

- ✅ 在编写代码前，阐述你基于内容的设计方法
- ✅ 仅使用网页安全字体：Arial、Helvetica、Times New Roman、Georgia、Courier New、Verdana、Tahoma、Trebuchet MS、Impact
- ✅ 通过大小、粗细和颜色创建清晰的视觉层次
- ✅ 确保可读性：强对比度、适当大小的文本、整洁的对齐
- ✅ 保持一致性：在幻灯片中重复使用模式、间距和视觉语言

#### 色彩选择

**创造性地选择颜色**：

- **超越默认**：哪些颜色真正匹配这个特定主题？避免自动选择。
- **考虑多个角度**：主题、行业、情绪、能量水平、目标受众、品牌标识（如果提到）
- **尝试冒险**：尝试意想不到的组合 - 医疗演示文稿不必是绿色的，金融不必是藏青色的
- **构建调色板**：选择 3-5 种协调的颜色（主导颜色 + 辅助色调 + 强调色）
- **确保对比度**：文本必须在背景上清晰可读

**示例调色板**（用这些激发创意 - 选择一个，调整它，或创建你自己的）：

1. **经典蓝**：深海军蓝(#1C2833)、板岩灰(#2E4053)、银色(#AAB7B8)、灰白色(#F4F6F6)
2. **青色与珊瑚色**：青色(#5EA8A7)、深青色(#277884)、珊瑚色(#FE4447)、白色(#FFFFFF)
3. **大胆红**：红色(#C0392B)、亮红色(#E74C3C)、橙色(#F39C12)、黄色(#F1C40F)、绿色(#2ECC71)
4. **暖腮红**：紫红色(#A49393)、腮红色(#EED6D3)、玫瑰色(#E8B4B8)、奶油色(#FAF7F2)
5. **勃艮第奢华**：勃艮第(#5D1D2E)、深红色(#951233)、铁锈色(#C15937)、金色(#997929)
6. **深紫与祖母绿**：紫色(#B165FB)、深蓝色(#181B24)、祖母绿(#40695B)、白色(#FFFFFF)
7. **奶油与森林绿**：奶油色(#FFE1C7)、森林绿(#40695B)、白色(#FCFCFC)
8. **粉红与紫色**：粉红色(#F8275B)、珊瑚色(#FF574A)、玫瑰色(#FF737D)、紫色(#3D2F68)
9. **石灰与梅子色**：石灰色(#C5DE82)、梅子色(#7C3A5F)、珊瑚色(#FD8C6E)、蓝灰色(#98ACB5)
10. **黑色与金色**：金色(#BF9A4A)、黑色(#000000)、奶油色(#F4F6F6)
11. **鼠尾草与赤土色**：鼠尾草绿(#87A96B)、赤土色(#E07A5F)、奶油色(#F4F1DE)、炭灰色(#2C2C2C)
12. **炭灰色与红色**：炭灰色(#292929)、红色(#E33737)、浅灰色(#CCCBCB)
13. **鲜橙色**：橙色(#F96D00)、浅灰色(#F2F2F2)、炭灰色(#222831)
14. **森林绿**：黑色(#191A19)、绿色(#4E9F3D)、深绿色(#1E5128)、白色(#FFFFFF)
15. **复古彩虹**：紫色(#722880)、粉红色(#D72D51)、橙色(#EB5C18)、琥珀色(#F08800)、金色(#DEB600)
16. **复古大地色**：芥末黄(#E3B448)、鼠尾草绿(#CBD18F)、森林绿(#3A6B35)、奶油色(#F4F1DE)
17. **海岸玫瑰**：旧玫瑰色(#AD7670)、海狸棕色(#B49886)、蛋壳白(#F3ECDC)、灰褐色(#BFD5BE)
18. **橙色与青色**：浅橙色(#FC993E)、灰青色(#667C6F)、白色(#FCFCFC)

#### 视觉细节选项

**几何图案**：

- 对角线分隔而非水平线
- 非对称列宽(30/70, 40/60, 25/75)
- 旋转 90° 或 270° 的文本标题
- 圆形/六角形图像框架
- 角落的三角形强调形状
- 重叠形状增加深度感

**边框与框架处理**：

- 仅在一侧使用粗单色边框(10-20pt)
- 对比色的双线边框
- 角括号而非完整框架
- L 形边框(上+左或下+右)
- 标题下方的下划线强调(3-5pt 厚)

**排版处理**：

- 极端尺寸对比(72pt 标题 vs 11pt 正文)
- 全大写标题并加宽字母间距
- 超大号显示字体的编号部分
- 等宽字体(Courier New)用于数据/统计/技术内容
- 压缩字体(Arial Narrow)用于密集信息
- 轮廓文本以强调

**图表与数据样式**：

- 单色图表，关键数据使用单一强调色
- 水平条形图代替垂直条形图
- 点图代替条形图
- 最少的网格线或完全没有
- 直接在元素上标注数据标签(无图例)
- 关键指标使用超大数字

**布局创新**：

- 全出血图像配合文字覆盖
- 侧边栏列(宽度 20-30%)用于导航/上下文
- 模块化网格系统(3×3, 4×4 块)
- Z 模式或 F 模式内容流
- 彩色形状上的浮动文本框
- 杂志风格多列布局

**背景处理**：

- 占据幻灯片 40-60%的纯色块
- 渐变填充(仅垂直或对角线)
- 分割背景(两种颜色，对角线或垂直)
- 边到边的色带
- 负空间作为设计元素

### 布局技巧

**创建带有图表或表格的幻灯片时：**

- **双列布局(首选)**：使用跨越全宽的标题，然后下方分为两列 - 一列放文本/要点，另一列放特色内容。这提供更好的平衡，使图表/表格更易读。使用带有不等列宽的 flexbox(例如，40%/60%分割)以优化每种内容类型的空间。
- **全幻灯片布局**：让特色内容(图表/表格)占据整个幻灯片以获得最大影响力和可读性
- **切勿垂直堆叠**：不要在单列中将图表/表格放在文本下方 - 这会导致可读性差和布局问题

### 工作流程

1. **必须 - 阅读整个文件**：从头到尾完整阅读[`html2pptx.md`](html2pptx.md)。**读取此文件时切勿设置任何范围限制。**在开始创建演示文稿之前，阅读完整文件内容以了解详细语法、关键格式规则和最佳实践。
2. 为每张幻灯片创建具有适当尺寸的 HTML 文件(例如，16:9 比例的 720pt × 405pt)
   - 对所有文本内容使用`<p>`、`<h1>`-`<h6>`、`<ul>`、`<ol>`
   - 对将添加图表/表格的区域使用`class="placeholder"`(渲染为灰色背景以提高可见性)
   - **关键**：首先使用 Sharp 将渐变和图标栅格化为 PNG 图像，然后在 HTML 中引用
   - **布局**：对于带有图表/表格/图像的幻灯片，使用全幻灯片布局或双列布局以提高可读性
3. 创建并运行使用[`html2pptx.js`](scripts/html2pptx.js)库的 JavaScript 文件，将 HTML 幻灯片转换为 PowerPoint 并保存演示文稿
   - 使用`html2pptx()`函数处理每个 HTML 文件
   - 使用 PptxGenJS API 向占位区域添加图表和表格
   - 使用`pptx.writeFile()`保存演示文稿
4. **视觉验证**：生成缩略图并检查布局问题
   - 创建缩略图网格：`python scripts/thumbnail.py output.pptx workspace/thumbnails --cols 4`
   - 阅读并仔细检查缩略图以发现：
     - **文本截断**：文本被标题栏、形状或幻灯片边缘截断
     - **文本重叠**：文本与其他文本或形状重叠
     - **定位问题**：内容太靠近幻灯片边界或其他元素
     - **对比度问题**：文本与背景之间对比度不足
   - 如果发现问题，调整 HTML 边距/间距/颜色并重新生成演示文稿
   - 重复直到所有幻灯片视觉正确

## 编辑现有 PowerPoint 演示文稿

编辑现有 PowerPoint 演示文稿中的幻灯片时，需要使用原始 Office Open XML (OOXML)格式。这涉及解压.pptx 文件，编辑 XML 内容并重新打包。

### 工作流程

1. **必须 - 阅读整个文件**：从头到尾完整阅读[`ooxml.md`](ooxml.md)(约 500 行)。**读取此文件时切勿设置任何范围限制。**在进行任何演示文稿编辑前，阅读完整文件内容以获取有关 OOXML 结构和编辑工作流程的详细指导。
2. 解压演示文稿：`python ooxml/scripts/unpack.py <office_file> <output_dir>`
3. 编辑 XML 文件(主要是`ppt/slides/slide{N}.xml`和相关文件)
4. **关键**：每次编辑后立即验证并在继续前修复任何验证错误：`python ooxml/scripts/validate.py <dir> --original <file>`
5. 打包最终演示文稿：`python ooxml/scripts/pack.py <input_directory> <office_file>`

## 创建新的 PowerPoint 演示文稿**（使用模板）**

当需要创建遵循现有模板设计的演示文稿时，需要先复制和重新排列模板幻灯片，然后替换占位内容。

### 工作流程

1. **提取模板文本并创建视觉缩略图网格**：

   - 提取文本：`python -m markitdown template.pptx > template-content.md`
   - 阅读`template-content.md`：阅读整个文件以了解模板演示文稿的内容。**读取此文件时切勿设置任何范围限制。**
   - 创建缩略图网格：`python scripts/thumbnail.py template.pptx`
   - 有关详细信息，请参见[创建缩略图网格](#创建缩略图网格)部分

2. **分析模板并将清单保存到文件**：

   - **视觉分析**：查看缩略图网格以了解幻灯片布局，设计模式和视觉结构
   - 创建模板清单文件并保存为`template-inventory.md`，包含：

     ```markdown
     # 模板清单分析

     **总幻灯片数：[数量]**
     **重要：幻灯片从 0 开始索引(第一张幻灯片 = 0，最后一张幻灯片 = 数量-1)**

     ## [类别名称]

     - 幻灯片 0：[布局代码如果有] - 描述/用途
     - 幻灯片 1：[布局代码] - 描述/用途
     - 幻灯片 2：[布局代码] - 描述/用途
       [... 必须单独列出每张幻灯片及其索引 ...]
     ```

   - **使用缩略图网格**：参考视觉缩略图来识别：
     - 布局模式(标题幻灯片，内容布局，分节符)
     - 图像占位符位置和数量
     - 幻灯片组中的设计一致性
     - 视觉层次和结构
   - 此清单文件是下一步选择适当模板所**必需的**

3. **基于模板清单创建演示文稿大纲**：

   - 查看步骤 2 中的可用模板。
   - 为第一张幻灯片选择简介或标题模板。这通常是前几个模板之一。
   - 为其他幻灯片选择安全的基于文本的布局。
   - **关键：将布局结构与实际内容匹配**：
     - 单列布局：用于统一叙述或单一主题
     - 双列布局：**仅**当你有恰好 2 个不同项目/概念时使用
     - 三列布局：**仅**当你有恰好 3 个不同项目/概念时使用
     - 图像+文本布局：**仅**当你有实际图像要插入时使用
     - 引用布局：**仅**用于带署名的人物实际引用，切勿用于强调
     - 不要使用比你的内容更多占位符的布局
     - 如果你有 2 个项目，不要强行使用 3 列布局
     - 如果你有 4 个及以上项目，考虑分成多张幻灯片或使用列表格式
   - 在选择布局**之前**统计实际内容项目
   - 验证所选布局中的每个占位符都将填充有意义的内容
   - 为每个内容部分选择代表**最佳**布局的一个选项
   - 保存带有内容和模板映射的`outline.md`，利用可用设计
   - 模板映射示例：
     ```
     # 要使用的模板幻灯片(基于0的索引)
     # 警告：验证索引在范围内！有73张幻灯片的模板索引为0-72
     # 映射：大纲中的幻灯片编号 -> 模板幻灯片索引
     template_mapping = [
         0,   # 使用幻灯片0(标题/封面)
         34,  # 使用幻灯片34(B1：标题和正文)
         34,  # 再次使用幻灯片34(复制第二个B1)
         50,  # 使用幻灯片50(E1：引用)
         54,  # 使用幻灯片54(F2：结束+文本)
     ]
     ```

4. **使用`rearrange.py`复制、重新排序和删除幻灯片**：

   - 使用`scripts/rearrange.py`脚本创建按所需顺序排列的新演示文稿：
     ```bash
     python scripts/rearrange.py template.pptx working.pptx 0,34,34,50,52
     ```
   - 该脚本会自动处理重复幻灯片的复制、未使用幻灯片的删除和重新排序
   - 幻灯片索引基于 0(第一张幻灯片是 0，第二张是 1，以此类推)
   - 相同的幻灯片索引可以出现多次以复制该幻灯片

5. **使用`inventory.py`脚本提取所有文本**：

   - **运行清单提取**：
     ```bash
     python scripts/inventory.py working.pptx text-inventory.json
     ```
   - **阅读 text-inventory.json**：阅读整个 text-inventory.json 文件以了解所有形状及其属性。**读取此文件时切勿设置任何范围限制。**

   - 清单 JSON 结构：

     ```json
     {
       "slide-0": {
         "shape-0": {
           "placeholder_type": "TITLE", // 非占位符为null
           "left": 1.5, // 位置（英寸）
           "top": 2.0,
           "width": 7.5,
           "height": 1.2,
           "paragraphs": [
             {
               "text": "段落文本",
               // 可选属性（仅在非默认时包含）：
               "bullet": true, // 检测到明确的项目符号
               "level": 0, // 仅当bullet为true时包含
               "alignment": "CENTER", // CENTER, RIGHT（非LEFT）
               "space_before": 10.0, // 段落前空间（点）
               "space_after": 6.0, // 段落后空间（点）
               "line_spacing": 22.4, // 行间距（点）
               "font_name": "Arial", // 来自第一个运行
               "font_size": 14.0, // 点大小
               "bold": true,
               "italic": false,
               "underline": false,
               "color": "FF0000" // RGB颜色
             }
           ]
         }
       }
     }
     ```

   - 关键特性：
     - **幻灯片**：命名为"slide-0"、"slide-1"等
     - **形状**：按视觉位置排序（从上到下，从左到右）为"shape-0"、"shape-1"等
     - **占位符类型**：TITLE, CENTER_TITLE, SUBTITLE, BODY, OBJECT 或 null
     - **默认字体大小**：从布局占位符中提取的`default_font_size`（点，如果可用）
     - **幻灯片编号被过滤**：带有 SLIDE_NUMBER 占位符类型的形状自动从清单中排除
     - **项目符号**：当`bullet: true`时，始终包含`level`（即使是 0）
     - **间距**：`space_before`、`space_after`和`line_spacing`（点，仅在设置时包含）
     - **颜色**：RGB 为`color`（例如，"FF0000"），主题颜色为`theme_color`（例如，"DARK_1"）
     - **属性**：输出中仅包含非默认值

6. **生成替换文本并将数据保存到 JSON 文件**
   基于上一步的文本清单：

   - **关键**：首先验证清单中存在哪些形状 - 仅引用实际存在的形状
   - **验证**：replace.py 脚本将验证替换 JSON 中的所有形状是否存在于清单中
     - 如果引用不存在的形状，将得到显示可用形状的错误
     - 如果引用不存在的幻灯片，将得到指示幻灯片不存在的错误
     - 所有验证错误会在脚本退出前一次性显示
   - **重要**：replace.py 脚本内部使用 inventory.py 来识别所有文本形状
   - **自动清除**：除非为形状提供"paragraphs"，否则清单中的所有文本形状都将被清除
   - 为需要内容的形状添加"paragraphs"字段（不是"replacement_paragraphs"）
   - 替换 JSON 中没有"paragraphs"的形状将自动清除其文本
   - 带有项目符号的段落将自动左对齐。当`"bullet": true`时不要设置`alignment`属性
   - 为占位文本生成适当的替换内容
   - 使用形状大小确定适当的内容长度
   - **关键**：包括原始清单中的段落属性 - 不要只提供文本
   - **重要**：当 bullet: true 时，不要在文本中包含项目符号（•，-，\*） - 它们会自动添加
   - **基本格式规则**：
     - 标题/标题通常应有`"bold": true`
     - 列表项应有`"bullet": true, "level": 0`（当 bullet 为 true 时 level 是必需的）
     - 保留任何对齐属性（例如，`"alignment": "CENTER"`表示居中文本）
     - 当与默认值不同时包含字体属性（例如，`"font_size": 14.0`，`"font_name": "Lora"`）
     - 颜色：对于 RGB 使用`"color": "FF0000"`，对于主题颜色使用`"theme_color": "DARK_1"`
     - 替换脚本期望**格式正确的段落**，而不仅仅是文本字符串
     - **重叠形状**：首选具有更大 default_font_size 或更合适 placeholder_type 的形状
   - 将带有替换内容的更新清单保存至`replacement-text.json`
   - **警告**：不同的模板布局有不同的形状计数 - 创建替换内容前始终检查实际清单

   示例 paragraphs 字段显示适当的格式：

   ```json
   "paragraphs": [
     {
       "text": "新的演示文稿标题文本",
       "alignment": "CENTER",
       "bold": true
     },
     {
       "text": "章节标题",
       "bold": true
     },
     {
       "text": "第一个项目符号点（无符号）",
       "bullet": true,
       "level": 0
     },
     {
       "text": "红色文本",
       "color": "FF0000"
     },
     {
       "text": "主题颜色文本",
       "theme_color": "DARK_1"
     },
     {
       "text": "没有特殊格式的普通段落文本"
     }
   ]
   ```

   **替换 JSON 中未列出的形状将自动清除**：

   ```json
   {
     "slide-0": {
       "shape-0": {
         "paragraphs": [...] // 该形状获得新文本
       }
       // 来自清单的shape-1和shape-2将自动清除
     }
   }
   ```

   **演示文稿常见格式模式**：

   - 标题幻灯片：粗体文本，有时居
